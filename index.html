<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DogeFlyer Game</title>
    <script src="https://telegram.org/js/games.js"></script>
    <style>
        /* ... (previous styles remain the same) ... */
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="scoreModal">
        <div class="modal-content">
            <h2>Game Over!</h2>
            <p>Your score: <span id="finalScore"></span></p>
            <button class="modal-button" id="restartButton">Retry</button>
            <button class="modal-button" id="shareButton">Share Game</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreModal = document.getElementById('scoreModal');
        const finalScoreSpan = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');
        const shareButton = document.getElementById('shareButton');

        // Check if running in Telegram
        const isTelegram = window.TelegramGameProxy !== undefined;

        // ... (image loading code remains the same) ...

        let dog, obstacles, score, lastObstacleY, gameActive;

        function initGame() {
            dog = {
                x: 50,
                y: canvas.height / 2,
                width: canvas.width * 0.2,
                height: canvas.width * 0.2,
                velocity: 0,
                lift: -canvas.height * 0.015
            };
            obstacles = [];
            score = 0;
            lastObstacleY = 0;
            gameActive = true;
        }

        const gravity = 0.2;
        const obstacleSpeed = 2;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            if (dog) {
                dog.width = canvas.width * 0.2;
                dog.height = dog.width;
                dog.lift = -canvas.height * 0.015;
                
                if (dog.y + dog.height > canvas.height) {
                    dog.y = canvas.height - dog.height;
                }
            }
        }

        function gameLoop() {
            if (gameActive) {
                update();
                draw();
            }
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // ... (update logic remains the same) ...
        }

        function draw() {
            // ... (draw logic remains the same) ...
        }

        function createObstacle() {
            // ... (obstacle creation logic remains the same) ...
        }

        function gameOver() {
            gameActive = false;
            finalScoreSpan.textContent = score;
            scoreModal.style.display = 'block';
            if (isTelegram) {
                TelegramGameProxy.setScore(score);
            }
        }

        function resetGame() {
            initGame();
            scoreModal.style.display = 'none';
        }

        function shareGame() {
            if (isTelegram) {
                TelegramGameProxy.shareScore();
            } else {
                // Fallback for non-Telegram environments
                alert("This game is designed to be played in Telegram.");
            }
        }

        canvas.addEventListener('click', function() {
            if (gameActive) {
                dog.velocity = dog.lift;
            }
        });

        restartButton.addEventListener('click', resetGame);
        shareButton.addEventListener('click', shareGame);

        window.addEventListener('resize', resizeCanvas);

        // Initialize and start the game
        resizeCanvas();
        initGame();
        gameLoop();

        // Telegram-specific initialization
        if (isTelegram) {
            TelegramGameProxy.initParams();
        }
    </script>
</body>
</html>